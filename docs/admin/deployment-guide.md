# デプロイメント手順

このドキュメントでは、Webサイトの公開と更新手順について説明します。

## 現在の公開環境

- **本番環境**: https://www.tomiokario.com/
- **ステージング環境**: https://my-web-page-fawn-seven.vercel.app/
- **ホスティング**: Vercel

## デプロイメントの流れ

### 自動デプロイ（推奨）

GitHubのmainブランチにプッシュすると、Vercelが自動的にデプロイを実行します。

1. ローカルで変更を加える
2. 変更をコミット
3. mainブランチにプッシュ
4. Vercelが自動的にビルド・デプロイを実行
5. デプロイ完了通知を確認

### 手動デプロイ

必要に応じて、Vercelダッシュボードから手動でデプロイを実行できます。

1. [Vercelダッシュボード](https://vercel.com)にログイン
2. プロジェクトを選択
3. "Deployments"タブを開く
4. "Redeploy"ボタンをクリック

## デプロイ前のチェックリスト

### 1. コンテンツの確認

- [ ] すべてのMarkdownファイルに文法エラーがないか
- [ ] 日本語・英語両方のコンテンツが更新されているか
- [ ] リンクが正しく設定されているか
- [ ] 画像が正しく表示されるか

### 2. 出版物データの更新

出版物リストを更新した場合：

```bash
# CSVファイルを更新後
npm run convert-publications
```

### 3. ローカルでの動作確認

```bash
# 開発サーバーで確認
npm start

# ビルドが成功するか確認
npm run build
```

### 4. テストの実行

```bash
npm test
```

## デプロイ後の確認

### 1. 本番環境での動作確認

- [ ] サイトが正しく表示されるか
- [ ] 言語切り替えが機能するか
- [ ] すべてのページにアクセスできるか
- [ ] 出版物リストが正しく表示されるか

### 2. パフォーマンスの確認

- ページの読み込み速度
- 画像の最適化状態
- レスポンシブデザインの動作

## トラブルシューティング

### ビルドエラーが発生する場合

1. エラーメッセージを確認
2. ローカルで`npm run build`を実行して再現するか確認
3. 依存関係の問題の場合：
   ```bash
   rm -rf node_modules package-lock.json
   npm install
   ```

### デプロイ後にサイトが表示されない場合

1. Vercelダッシュボードでデプロイステータスを確認
2. ビルドログでエラーがないか確認
3. ドメイン設定が正しいか確認

### 更新が反映されない場合

1. ブラウザのキャッシュをクリア
2. CDNのキャッシュパージを実行（Vercelダッシュボードから）
3. 数分待ってから再度確認

## ロールバック手順

問題が発生した場合の以前のバージョンへの戻し方：

### Vercelダッシュボードから

1. "Deployments"タブを開く
2. 正常に動作していた過去のデプロイメントを選択
3. "Promote to Production"をクリック

### Gitから

```bash
# 特定のコミットに戻す
git revert [コミットハッシュ]
git push origin main
```

## セキュリティに関する注意事項

- APIキーや認証情報をコードに含めない
- 環境変数はVercelの環境変数設定で管理
- 機密情報を含むファイルは`.gitignore`に追加

## 関連ドキュメント

- [サイト設定ガイド](./site-configuration.md)
- [技術的な詳細](../technical/development-workflow.md)