# テスト改善計画案

このドキュメントは、my-web-pageプロジェクトのテスト体制を強化するための計画案です。

## 改善ステップ

以下のステップでテスト体制の強化を図ります。

1.  **テストカバレッジの計測と目標設定:**
    *   **現状把握:** `npm test -- --coverage` を実行し、現在のテストカバレッジレポートを生成・分析します。
    *   **課題特定:** カバレッジが低い箇所、特に重要なビジネスロジックや複雑なコンポーネントでテストが不足している箇所を特定します。
    *   **目標設定:** プロジェクトの特性と重要度を考慮し、現実的なカバレッジ目標（例: 行カバレッジ80%以上）を設定します。
    *   **アクション:** 目標達成に向けて、不足している単体テスト・統合テストを追加します。

2.  **テストデータ管理方法の改善:**
    *   **方針決定:** テストデータの管理方針を明確にします。テストデータ生成ライブラリ (例: Faker.js) やファクトリパターンを利用し、再利用可能で保守しやすいテストデータを生成する仕組みを検討します。
    *   **アクション:** 決定した方針に基づき、既存のテストデータの見直しとリファクタリングを行います。テストデータ管理に関するガイドラインをドキュメント化します。

3.  **`convertPublications.ts` スクリプトのテスト追加:**
    *   **アクション:** `scripts/convertPublications.ts` スクリプトに対する統合テストを作成します。テスト用のサンプルCSVファイルを用意し、スクリプト実行後に生成されるJSONファイルの内容が期待通りであることを検証します。ファイルI/Oを含むテストとなるため、一時ファイルを利用するなどの工夫をします。

4.  **テスト実行時間の監視と最適化:**
    *   **監視:** CI/CD環境でテストスイート全体の実行時間を計測・記録します。
    *   **最適化検討:** 実行時間が許容範囲を超えた場合に、テストの並列実行 (`jest --maxWorkers`) や、変更があったファイルに関連するテストのみを実行する仕組み (`jest --changedSince`) の導入を検討します。

5.  **パフォーマンステストの導入:**
    *   **対象特定:** パフォーマンスが特に重要となる箇所（例: Publicationsページの初期表示、大量データフィルタリング時）を特定します。
    *   **ツール選定:** パフォーマンステストツールを選定します (候補: Lighthouse CI, `@playwright/test` のトレース機能)。
    *   **アクション:** 特定箇所に対してベースラインとなるパフォーマンス指標を計測し、CI/CDプロセスに組み込んで継続的に監視します。閾値を超えた場合にアラートを出す仕組みも検討します。

6.  **E2E (End-to-End) テストの導入:** (優先度: 低)
    *   **必要性評価:** 主要なユーザーストーリー（例: ページ遷移、出版物フィルタリング、言語切り替え）を洗い出し、E2Eテストでカバーすべき範囲を決定します。
    *   **ツール選定:** E2Eテストフレームワークを選定します (候補: Cypress, Playwright)。選定基準は、学習コスト、実行速度、CI/CD連携の容易さなどです。
    *   **アクション:** 選定したツールを導入し、特定した主要ユーザーストーリーに対するE2Eテストを実装します。

7.  **ドキュメントの更新:**
    *   **アクション:** 上記1〜6で決定・実施したテスト戦略の変更点（導入したツール、カバレッジ目標、テストの種類など）を `docs/testing-strategy.md` および関連ドキュメントに反映させます。

## 計画の可視化 (Mermaid)

```mermaid
graph TD
    A[現状分析] --> B(テストカバレッジ計測);
    A --> C(テストデータ管理方法確認);
    A --> D(スクリプトテスト確認);
    A --> E(テスト実行時間確認);
    A --> F(パフォーマンステスト現状確認);
    A --> G(E2Eテスト現状確認);


    B --> H{カバレッジ目標設定};
    H -- 目標未達 --> I[テストケース追加];
    H -- 目標達成 --> J[継続監視];

    C --> K{管理方法改善要否判断};
    K -- 必要 --> L[管理方針決定 & 実装];
    L --> M[ドキュメント化];
    K -- 不要 --> J;

    D --> N{テスト不足};
    N -- 不足あり --> O[スクリプトテスト追加];
    N -- 不足なし --> J;

    E --> P{実行時間問題あり?};
    P -- はい --> Q[最適化策検討・導入];
    P -- いいえ --> J;

    F --> R{Perfテスト導入要否判断};
    R -- 必要 --> S[ツール選定 & 実装];
    R -- 不要 --> J;

    G --> T{E2Eテスト導入要否判断};
    T -- 必要 --> U[ツール選定 & 実装 (低優先)];
    T -- 不要 --> J;


    I --> V[ドキュメント更新];
    L --> V;
    M --> V;
    O --> V;
    Q --> V;
    S --> V;
    U --> V;
    J --> V;


    V --> W[改善完了];

    subgraph ドキュメント
        M
        V
    end

    subgraph テスト実装・改善
        I
        L
        O
        Q
        S
        U
    end